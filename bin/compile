#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>

arrow() {
  sed -u 's/^/-----> /'
}

indent() {
  sed -u 's/^/       /'
}

S3_BASE_URL="https://s3.amazonaws.com/crystalvista/devtools"
TARGET_PATH="/tmp/codon/vendor"

function install()
{
  local tarball destdir
  tarball="$1"
  destdir="$2"

  mkdir -p "$TARGET_PATH/$destdir"
  echo "Fetching   $S3_BASE_URL/$tarball" | indent
  curl --fail --retry 3 --retry-delay 1 --connect-timeout 3 "$S3_BASE_URL/$tarball" -s -o - | tar zxf - -C "$TARGET_PATH/$destdir"
}

echo "Installing cmake" | arrow

# download and unpack
install "cmake.tar.gz"

cd "$TARGET_PATH/bin"
echo "Installed: "`ls c*` | indent
echo
